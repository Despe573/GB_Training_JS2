(()=>{"use strict";function t(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}class e{constructor({name:e,price:r,img:s},n){t(this,"_name",""),t(this,"_price",0),t(this,"_img",""),t(this,"_cartInstane",null),this._name=e,this._price=r,this._img=s,this._cartInstane=n}addToCard(){this._cartInstane.add(this,this._cartInstane)}render(){const t=document.querySelector(".cardsWrap");if(t){const e=document.createElement("div"),s=new r("Добавить в корзину",this.addToCard.bind(this));e.classList.add("card"),e.innerHTML=`<img src="${this._img}" /><br>${this._name} - ${this._price}<br>`,s.renderButton(e),t.appendChild(e)}}}class r{constructor(e,r){t(this,"_text",""),t(this,"_callback",null),this._text=e,this._callback=r}pushThebutton(){const t=this._callback;"function"==typeof t&&t()}getTheButton(){const t=document.createElement("button");return t.classList.add("cardButton"),t}renderButton(t){if(t){const e=this.getTheButton();e.innerHTML=this._text,t.appendChild(e),e.addEventListener("click",(()=>{this.pushThebutton()}))}}}class s extends e{constructor(t,e){super(t,e)}render(){const t=document.querySelector(".basketWrap");if(t){t.classList.add("grid");const e=document.createElement("div"),s=new r("Удалить из корзины",this.delToCard.bind(this));e.classList.add("card",`${this._name}`),e.innerHTML=`<img src="${this._img}" /><br>${this._name} - ${this._price}<br>`,s.renderButton(e),t.appendChild(e),this.result()}}delToCard(){const t=document.querySelectorAll(`.${this._name}`);t&&t.forEach((t=>{t.remove()}));let e=this._cartInstane.cartStorage.filter((t=>t.name!==this._name));this._cartInstane.cartStorage=e;const r=document.querySelector(".basketWrap"),s=document.querySelector(".content");1===r.childElementCount&&(r.classList.remove("grid"),s.classList.remove("grid")),this.result()}result(){const t=document.querySelector(".qty"),e=document.querySelector(".sum");t&&e&&(t.innerHTML=`Всего товаров - ${this._cartInstane.cartStorage.length}`,e.innerHTML=`Сумма заказа - ${(()=>{let t=0;for(let e=0;e<this._cartInstane.cartStorage.length;e++)t+=this._cartInstane.cartStorage[e].price;return t})()}`)}}document.querySelector(".order").addEventListener("click",(()=>{alert("Спасибо за Заказ!"),location.reload()}));const n=new class{constructor(){t(this,"_item",{}),t(this,"_cartInstane",null),t(this,"cartStorage",[])}add(t,e){if(t){let r={};r.name=t._name,r.price=t._price,r.img=t._img,this.cartStorage.push(r),this._cartInstane=e,this._item=new s(r,this._cartInstane),this.render()}}render(){document.querySelector(".content").classList.add("grid"),this._item.render()}};new class{constructor(r){t(this,"_items",[]),this.fetchProducts().then((t=>t.json())).then((t=>{const s=t.data.map((t=>new e(t,r)));this._items=s,this.render()}))}fetchProducts(){try{return fetch("http://localhost:1313/database/data1.json")}catch(t){return fetch("https://gb-js2-lesson3-gobnfnstg6vq5ct.herokuapp.com/database/data.json")}}render(){this._items.forEach((t=>{t.render()}))}}(n)})();